#!/usr/bin/env python3
# This file is placed in the Public Domain.


import doctest
import inspect
import os
import shutil
import sys
import time
import unittest


sys.path.insert(0, os.getcwd())
sys.path.insert(0, os.getcwd() + os.sep + "lib")


from odb import Config
from ofn import format
from ohd import Handler


flags = doctest.REPORT_NDIFF | doctest.FAIL_FAST | doctest.ELLIPSIS
results = []


Config.debug = True
Config.workdir = ".test"


class CLI(Handler):

    def cmd(self, txt):
        self.handle(Event(txt, repr(self)))

    def raw(self, txt):
        print(txt)


c = CLI()


def main():
    if os.path.exists(".test"):
        shutil.rmtree(".test")
    print("GENOCIDE tests started at %s" % time.ctime(time.time()).replace("  ", " "))
    print(format(Config))
    pat = "test_%s*" % "*"
    suite = unittest.loader.TestLoader().discover("test", pattern=pat)
    unittest.TextTestRunner(verbosity=3).run(suite)


main()
