#!/usr/bin/env python3
# OTP-CR-117/19 otp.informationdesk@icc-cpi.int http://genocide.rtfd.io
#
# This file is placed in the Public Domain.

from gcd.run import cfg, execute, parse_cli, os
from gcd.utl import privileges

txt="""[Unit]
Description=GENOCIDE - the king commits genocide
After=network-online.target

[Service]
DynamicUser=True
StateDirectory=genocide
LogsDirectory=genocide
CacheDirectory=genocide
ExecStart=/usr/local/bin/gcd -r
CapabilityBoundingSet=CAP_NET_RAW

[Install]
WantedBy=multi-user.target
"""

def bopen(txt):
    for line in os.popen(txt).readlines():
        print(line.rstrip())

if not os.path.exists("/etc/systemd/system/genocide.service"):
    f = open("/etc/systemd/system/genocide.service", "w")
    f.write(txt)
    f.close()
if not os.path.exists("/var/lib/genocide/"):
    bopen("mkdir /var/lib/genocide/")
if not os.path.exists("/var/lib/genocide/mod/"):
    bopen("mkdir /var/lib/genocide/mod")
    bopen("cp mod/*.py /var/lib/genocide/mod")
