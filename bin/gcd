#!/usr/bin/env python3
# GENOCIDE - using the law to administer poison equals genocide. (bin/gcd)
#
# This file is placed in the Public Domain.

import os, sys; sys.path.insert(0, os.getcwd())

import readline

from gcd.bsc import Basic
from gcd.csl import console
from gcd.dbs import last
from gcd.obj import format, load, save
from gcd.run import cfg, parse_cli, sys
from gcd.thr import launch
from gcd.utl import privileges, os

def main():
    cfg.wd = "/var/lib/genocide/"
    cfg.md = os.path.join(cfg.wd, "mod")
    parse_cli()
    privileges("genocide")
    if cfg.op("s"):
        save(cfg)
    elif cfg.op("l"):
        last(cfg)
    if cfg.op("h"):
        import mod.hlp
        print(mod.hlp.__doc__)
        print(format(cfg))
        return
    h = Basic()
    h.walk("mod")
    h.fromdir(cfg.md)
    if cfg.txt:
        return h.cmd(cfg.otxt)
    h.start()
    print(cfg.mods)
    h.init(cfg.mods)
    if cfg.op("c"):
        h.walk("gcd")
        h.init("csl")
    if cfg.op("c"):
        h.wait()

if __name__ == "__main__":
    console(main)
