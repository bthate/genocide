#!/usr/bin/env python3
# This file is placed in the Public Domain.


"OTP-CR-117/19"


import importlib
import inspect
import os
import queue
import readline
import sys
import termios
import threading
import time
import types
import traceback
import _thread


sys.path.insert(0, os.getcwd())


from genocide.obj import Class, Config, Db, Object
from genocide.obj import cdir, find, fntime, format, get, register, save, spl, update
from genocide.hdl import Callbacks, CLI, Console, dispatch, starttime
from genocide.irc import IRC
from genocide.run import boot, isopt, scan, wait, wrap
from genocide.mdl import init


import genocide.bsc


Config.name = "genocide"
Config.threaded = False
Config.version = "71"
Config.workdir = "/var/lib/genocide"


class CLI(CLI):

    def raw(self, txt):
        print(txt)


class Console(Console):

    def raw(self, txt):
        print(txt)




def main():
    boot()
    cdir(Config.workdir)
    if len(sys.argv) > 1 and not isopt("ic"):
        c = CLI()
        return c.cmd(" ".join(sys.argv[1:]))
    if isopt("t"):
        Config.threaded = True
    if isopt("v"):
        Config.verbose = True
    if isopt("i"):
        irc = IRC()
        irc.start()
    if isopt("c"):
        print("GENOCIDE shell started at %s" % time.ctime(starttime).replace("  ", " "))
        print(format(Config, skip="password"))
        c = Console()
        c.start()
        c.forever()
    if isopt("ic"):
        init()
        wait()

wrap(main)
