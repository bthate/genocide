#!/usr/bin/env python3
# This file is placed in the Public Domain.
# pylint: disable=C0115,C0116


"Reconsider OTP-CR-117/19 - http://pypi.org/project/genocide"


import inspect
import os
import sys


from genocide import Cfg, Command, Handler, Wd, command, parse
from genocide.mod import cmd, irc, mdl, rss


Wd.workdir = os.path.expanduser("/var/lib/genocide/")


class CLI(Handler):

    @staticmethod
    def announce(txt):
        CLI.raw(txt)

    @staticmethod
    def raw(txt):
        cprint(txt)

    def say(self, channel, txt):
        self.raw(txt)


def cprint(txt):
    print(txt)
    sys.stdout.flush()


def scan(mod):
    for key, cmd in inspect.getmembers(mod, inspect.isfunction):
        if key.startswith("cb"):
            continue
        names = cmd.__code__.co_varnames
        if "event" in names:
            Command.add(cmd)


def main():
    parse(' '.join(sys.argv[1:]))
    scan(cmd)
    scan(irc)
    scan(mdl)
    scan(rss)
    cli = CLI()
    evt = command(cli, Cfg.prs.otxt)
    evt.wait()


main()
