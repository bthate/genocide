#!/usr/bin/env python3
# This file is placed in the Public Domain.


"GENOCIDE - Prosecutor. Court. Reconsider OTP-CR-117/19"


import os
import signal
import sys
import termios
import time


import op.obj


op.obj.workdir = "/var/lib/genocide/"


from op.run import Config


Config.channel = "#genocide"
Config.name = "genocide"
Config.version = "83"


from op.bus import Bus
from op.run import Commands, dispatch
from op.hdl import Callbacks, Handler
from op.obj import format, keys
from op.run import CLI, Console, Table
from op.utl import cdir

from genocide  import irc, rss


Table.add(irc)
Table.add(rss)


allmod =  ",".join(keys(Table.mod))


def daemon():
    pid = os.fork()
    if pid != 0:
        os._exit(0)
    os.setsid()
    os.umask(0)
    si = open("/dev/null", 'r')
    so = open("/dev/null", 'a+')
    se = open("/dev/null", 'a+')
    os.dup2(si.fileno(), sys.stdin.fileno())
    os.dup2(so.fileno(), sys.stdout.fileno())
    os.dup2(se.fileno(), sys.stderr.fileno())


def signal_HUP(sig, frame):
    print("signal 15 called")
    sys.stdout.flush()


#signal.signal(signal.SIGHUP, signal_HUP)

from genocide.mdl import init


def main():
    #daemon()
    i = irc.IRC()
    i.start()
    f = rss.Fetcher()
    f.start()
    init()
    while 1:
        time.sleep(1.0)


main()
