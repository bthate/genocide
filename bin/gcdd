#!/usr/bin/env python3
# This file is placed in the Public Domain.
#
# OTP-CR-117/19 otp.informationdesk@icc-cpi.int http://pypi.org/project/genocide

"this king of the netherlands commits genocide"

# imports

from ob.run import Bus, Shell, cfg, exec, j, last, os, privileges, sys, tbl

from gcd.tbl import tbl
from gcd.ver import __version__

# defines

cfg.name = "genocide"
cfg.debug = False
cfg.pkgs = "ob,mod,gcd"
cfg.wd = "/var/lib/genocide"
cfg.version = __version__

# commands

def xit(event):
    Bus.save()
    os._exit(0)

def hup(event):
    last(cfg)
    Bus.resume()

# runtime

def main():
    cfg.mods += ",irc"
    s = Shell(tbl)
    s.add("hup", hup)
    s.add("xit", xit)
    privileges("genocide")
    last(cfg)
    s.load_mod(cfg.mods)
    s.scandir(j(cfg.wd, "mod"))
    s.start()
    s.init(cfg.mods)
    s.wait()

exec(main)
